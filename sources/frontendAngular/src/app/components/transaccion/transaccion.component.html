<div class="transaccion-container">
  <!-- Información del activo -->
  <div class="activo-info" *ngIf="activo">
    <h2>{{activo.nombre}} ({{activo.simbolo}})</h2>
    <div class="precio-actual">{{formatearPrecio(getPrecioActivo())}}</div>
  </div>

  <!-- Formulario de transacción -->
  <div class="transaccion-form">
    <!-- Selector de tipo de transacción -->
    <div class="tipo-selector">
      <div 
        class="tipo-option compra"
        [class.active]="tipo === 'compra'"
        [class.disabled]="procesandoTransaccion"
        (click)="cambiarTipoTransaccion('compra')">
        Comprar
      </div>
      <div 
        class="tipo-option venta"
        [class.active]="tipo === 'venta'"
        [class.disabled]="procesandoTransaccion"
        (click)="cambiarTipoTransaccion('venta')">
        Vender
      </div>
    </div>

    <!-- Información disponible para ventas -->
    <div class="info-disponible" *ngIf="tipo === 'venta'">
      <div *ngIf="cantidadDisponible > 0; else noDisponible">
        <strong>Cantidad disponible: {{cantidadDisponible}} unidades</strong>
        <small class="text-muted d-block">Puedes vender hasta {{cantidadDisponible}} {{cantidadDisponible === 1 ? 'unidad' : 'unidades'}} de {{activo?.simbolo}}</small>
      </div>
      <ng-template #noDisponible>
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle me-2"></i>
          No tienes unidades de {{activo?.simbolo}} en tu portafolio para vender.
        </div>
      </ng-template>
    </div>

    <!-- Información para compras cuando ya tienes el activo -->
    <div class="info-disponible" *ngIf="tipo === 'compra' && cantidadDisponible > 0">
      <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        Ya tienes {{cantidadDisponible}} {{cantidadDisponible === 1 ? 'unidad' : 'unidades'}} de {{activo?.simbolo}} en tu portafolio.
        <br><small>Al comprar más, se calculará el precio promedio de compra.</small>
      </div>
    </div>

    <!-- Entrada de cantidad -->
    <div class="cantidad-input">
      <label for="cantidad">Cantidad:</label>
      <input 
        type="number" 
        id="cantidad"
        [value]="cantidad"
        [disabled]="procesandoTransaccion"
        (input)="onCantidadInput($event)"
        (change)="onCantidadChange()"
        min="1"
        [max]="tipo === 'venta' ? cantidadDisponible : undefined">
    </div>

    <!-- Resumen de la transacción -->
    <div class="resumen-transaccion" *ngIf="activo">
      <div class="resumen-linea">
        <span>Precio por unidad:</span>
        <span>{{formatearPrecio(getPrecioActivo())}}</span>
      </div>
      <div class="resumen-linea">
        <span>Cantidad:</span>
        <span>{{cantidad}}</span>
      </div>
      <div class="resumen-linea total">
        <span>Total:</span>
        <span>{{formatearPrecio(costoTotal)}}</span>
      </div>
      <div class="resumen-linea">
        <span>Saldo {{tipo === 'compra' ? 'restante' : 'resultante'}}:</span>
        <span [class.saldo-negativo]="saldoRestante < 0">{{formatearPrecio(saldoRestante)}}</span>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="botones-accion">
      <button 
        type="button" 
        class="btn btn-secondary"
        [disabled]="procesandoTransaccion"
        (click)="cancelar()">
        Cancelar
      </button>
      <button 
        type="button" 
        class="btn btn-primary"
        [disabled]="!puedeIniciarTransaccion()"
        (click)="confirmarTransaccion()">
        <span *ngIf="procesandoTransaccion" class="spinner-border spinner-border-sm me-2"></span>
        {{procesandoTransaccion ? 'Procesando...' : (tipo === 'compra' ? 'Confirmar Compra' : 'Confirmar Venta')}}
      </button>
    </div>

    <!-- Mensaje de confirmación -->
    <div class="mensaje-confirmacion" *ngIf="activo && puedeRealizarTransaccion()">
      {{getMensajeConfirmacion()}}
    </div>
  </div>
</div>
